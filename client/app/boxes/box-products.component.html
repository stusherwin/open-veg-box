<div #root cc-focus #focusable=cc-focus (focus)="onRootFocus()" (blur)="onRootBlur()" class="box-products" [class.adding]="addingProduct" [class.editing]="editingProduct">
  <div class="box-product-column" *ngFor="let c of columns; let i = index" [style.margin-left.px]="i && columnPadding">
    <div class="box-product" *ngFor="let p of c" [class.remove-hover]="removeHoverProductId == p.id" (keydown)="keydown($event)">
      <div class="box-product-detail box-product-name" [style.width.px]="productNameWidth + productNamePadding">{{p.name}}</div>
      <div class="box-product-detail box-product-quantity" [class.box-product-display]="!editingProduct || editingProduct.id != p.id" [class.box-product-edit]="editingProduct && editingProduct.id == p.id" style="position: relative" [style.width.px]="productQuantityWidth + productQuantityPadding">
        <div style="display: inline-block" *ngIf="!editingProduct || editingProduct.id != p.id" (click)="onEditClick(p)">
          <span class="box-product-quantity-each" *ngIf="p.unitType == 'each'">x</span>
          <span *ngIf="p.unitType == 'perKg'">{{p.quantity | weight}}</span>
          <span *ngIf="p.unitType != 'perKg'">{{p.quantity}}</span>
          <i class="icon-edit"></i>
        </div>
        <div *ngIf="editingProduct && editingProduct.id == p.id" class="edit-background">
          <i class="icon-ok" (click)="onEditOkClick()"></i><i class="icon-cancel" (click)="onEditCancelClick()"></i>
        </div>
        <input type="text" style="position: absolute;left:-10000px" *ngIf="!editingProduct || editingProduct.id != p.id" (focus)="onEditFocus(p)" tabindex="1" />
        <div style="display: inline-block" *ngIf="editingProduct && editingProduct.id == p.id">
          <span class="box-product-quantity-each" *ngIf="editingProduct.unitType == 'each'">x</span>
          <input type="text" class="input" [ngModel]="editingProduct.quantity" (ngModelChange)="onEditQuantityChange($event)" tabindex="1" />
          <span class="box-product-quantity-perkg" *ngIf="editingProduct.unitType == 'perKg'">Kg</span>
        </div>
      </div>
      <div *ngIf="!editingProduct || editingProduct.id != p.id" class="box-product-detail box-product-action box-product-display">
        <i class="icon-trash" (click)="onRemoveClick(p)" (mouseenter)="onRemoveEnter(p)" (mouseleave)="onRemoveLeave()"></i>
      </div>
    </div>
    <div class="box-product box-product-add" *ngIf="i == columns.length - 1" [class.no-products]="!value.length" (keydown)="keydown($event)">
      <div *ngIf="!value.length && !addingProduct" class="box-product-detail no-products-text">No products added yet.</div> 
      <div *ngIf="unusedProducts.length && !addingProduct" (click)="onAddClick()">
        <div class="box-product-detail box-product-name box-product-display" [style.width.px]="productNameWidth + productNamePadding + productQuantityWidth + productQuantityPadding">Add
          <span *ngIf="!value.length">a</span>
          <span *ngIf="value.length">another</span>
          product...</div>
        <div class="box-product-detail box-product-action box-product-display">
          <i class="icon-add"></i>
        </div>       
      </div>
      <div *ngIf="addingProduct" style="position: relative" class="box-product-detail" [style.width.px]="productNameWidth + productNamePadding + productQuantityWidth + productQuantityPadding">
        <div class="edit-background">
          <i class="icon-ok" (click)="onAddOkClick()"></i><i class="icon-cancel" (click)="onAddCancelClick()"></i>
        </div>
        <div class="box-product-detail box-product-name box-product-edit" [style.width.px]="productNameWidth + productNamePadding"><select (change)="onAddProductChange($event)">
            <option *ngFor="let p of unusedProducts; let i = index" [value]="i">{{p.name}}</option>
          </select>
        </div>
        <div class="box-product-detail box-product-quantity box-product-edit" [style.width.px]="productQuantityWidth + productQuantityPadding">
          <span class="box-product-quantity-each" *ngIf="addingProduct.unitType == 'each'">x</span>
          <input type="text" class="input" [ngModel]="addingProduct.quantity" (ngModelChange)="onAddQuantityChange($event)" />
          <span class="box-product-quantity-perkg" *ngIf="addingProduct.unitType == 'perKg'">Kg</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="box-products width-test">
  <div class="box-product-column">
    <div class="box-product">
      <div #productNameTest class="box-product-detail box-product-name box-product-display" *ngFor="let p of value">{{p.name}}</div>
      <div #productNameTest class="box-product-detail box-product-name box-product-edit"><select>
          <option *ngFor="let p of unusedProducts">{{p.name}}</option>
        </select>
      </div>
      <div #productQuantityTest class="box-product-detail box-product-quantity box-product-display hover" *ngFor="let p of value">
        <span class="box-product-quantity-each" *ngIf="p.unitType == 'each'">x</span>
        <span *ngIf="p.unitType == 'perKg'">{{p.quantity | weight}}</span>
        <span *ngIf="p.unitType != 'perKg'">{{p.quantity}}</span>
        <i class="icon-edit"></i>
      </div>
      <div #productQuantityTest class="box-product-detail box-product-quantity box-product-edit"><input type="text" class="input" />
        <span class="box-product-quantity-perkg">Kg</span>
      </div>
    </div>
  </div>
</div>