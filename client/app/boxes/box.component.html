<div class="row" [class.addMode]="addMode" cc-focus focusedClass="focused" [handleClickOutside]="true" (focus)="onRowFocus()" (blur)="onRowBlur()">
  <input type="checkbox" cc-focus *ngIf="addMode && !rowFocused" style="position: absolute;left:-1000px" [tabindex]="index * 2" />
  <div class="actions">
    <div class="action" *ngIf="!addMode || !adding">
    </div>
    <div class="action" *ngIf="!addMode">
      <button cc-focus (click)="onDelete()" [tabindex]="(index * 2) + 2">
        <div class="icon"><i class="icon-trash"></i></div>
        <span>Delete</span>
      </button>
    </div>
    <div class="action" [hidden]="!addMode || adding || !loaded">
      <button #addButton=cc-focus cc-focus (click)="startAdd()" [tabindex]="(index * 2) + 2">
        <div class="icon"><i class="icon-add"></i></div>
        <span>Add</span>
      </button>  
    </div>
    <div class="action" *ngIf="addMode && adding">
      <button cc-focus (click)="completeAdd()" [tabindex]="(index * 2) + 2">
        <div class="icon"><i class="icon-ok"></i></div>
        <span>Save</span>
      </button>  
    </div>
    <div class="action" *ngIf="addMode && adding">
      <button cc-focus (click)="cancelAdd()" [tabindex]="(index * 2) + 2">
        <div class="icon"><i class="icon-cancel"></i></div>
        <span>Cancel</span>
      </button>  
    </div>
  </div>
  <p *ngIf="addMode && loaded && showAddMessage && !adding">There are no boxes yet.</p>
  <p *ngIf="addMode && !loaded"><i class="icon-spin3 animate-spin"></i> Loading boxes...</p>
  <div class="details" [hidden]="addMode && !adding">
    <cc-heading [addMode]="addMode" #boxName [(value)]="box.name" (update)="onUpdate()" [editTabindex]="(index * 2) + 1"></cc-heading>
    <div class="flex">
      <div class="price-detail">
        <cc-box-price 
          [addMode]="addMode"
          [(value)]="box.price"
          (update)="onUpdate()"
          [editTabindex]="(index * 2) + 1">
        </cc-box-price>
      </div>
      <div></div>
    </div>
    <cc-box-products *ngIf="!addMode"
      editId="bp{{box.id}}"
      [value]="box.products"
      [products]="products"
      [editTabindex]="(index * 2) + 1"
      (add)="onProductAdd($event)"
      (update)="onProductUpdate($event)"
      (remove)="onProductRemove($event)">
    </cc-box-products>
  </div>
</div>