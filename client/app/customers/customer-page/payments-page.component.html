<div class="deliveries">
  <div class="row-header">
    <h4>
      <i class="icon-clipboard"></i>Current balance: <span [innerHTML]="model.currentBalance | money:true:true"></span>
    </h4>
  </div>
  <div class="row-view-new no-hover">
    <div class="row" style="height: 0;padding: 0">
    </div>
    <div class="row">
      <div class="details" style="padding-left: 0;">
      </div>
    </div>
  </div>
  <div class="row-header">
    <a cc-button right icon="pound" text="Make payment" (click)="model.startPayment()" *ngIf="!model.makingPayment"></a>
    <h4>
      <i class="icon-history"></i>Past payments:
      <span innerHTML="{{model.pastPaymentsTotal | money:true}}"></span>
    </h4>
  </div>
  <div class="row-view-new no-hover">
    <div class="row" style="height: 0;padding: 0" *ngIf="!model.makingPayment">
    </div>
    <div class="row focused" *ngIf="model.makingPayment">
      <div class="details" style="padding-left: 0;margin-top: -5px; margin-bottom: -5px;display: block;">
        <table class="contact-details" style="float: none; width: auto;">
          <tr>
            <th style="width: 90px;vertical-align: middle">Amount:</th>
            <td style="width: 250px" *ngIf="model.currentBalance < 0">
              <input type="radio" name="paymentAmount" id="outstanding" value="outstanding" [checked]="model.paymentAmountOptions == 'outstanding'" (change)="model.paymentAmountOptions = $event.target.value" />
              <label for="outstanding">Outstanding <span class="muted"><span [innerHTML]="-model.currentBalance | money:true"></span></span></label>
            </td>
            <td style="width: 400px" *ngIf="model.currentBalance < 0">
              <input type="radio" name="paymentAmount" id="otherAmount" value="otherAmount" [checked]="model.paymentAmountOptions == 'otherAmount'" (change)="model.paymentAmountOptions = $event.target.value" />
              <label for="otherAmount">Another amount:</label>
              <span style="margin-left: 10px">&pound;<cc-number cssClass="price" (inputFocus)="model.paymentAmountOptions = 'otherAmount'" style="width: 80px;margin-left: 5px;" [(value)]="model.paymentAmount" [decimalPrecision]="2" [control]="paymentAmountControl"></cc-number></span>
            </td>
            <td colspan="2" *ngIf="model.currentBalance >= 0">
              &pound;<cc-number cssClass="price" (inputFocus)="model.paymentAmountOptions = 'otherAmount'" style="width: 80px;margin-left: 5px;" [(value)]="model.paymentAmount" [decimalPrecision]="2" [control]="paymentAmountControl"></cc-number>
            </td>
          </tr>
          <tr>
            <th style="width: 90px;vertical-align: middle">Date:</th>
            <td style="width: 250px">
              <input type="radio" name="paymentDate" id="today" value="today" [checked]="model.paymentDateOptions == 'today'" (change)="model.paymentDateOptions = $event.target.value" tabindex="1" />
              <label for="today">Today <span class="muted">{{model.todaysDate | dateString:'yMMMd'}}</span></label>
            </td>
            <td style="width: 400px">
              <input type="radio" name="paymentDate" id="otherDate" value="otherDate" [checked]="model.paymentDateOptions == 'otherDate'" (change)="model.paymentDateOptions = $event.target.value" tabindex="1" />
              <label for="otherDate">Another date:</label>
              <cc-date (inputFocus)="model.paymentDateOptions = 'otherDate'" [(value)]="model.paymentDate" [control]="paymentDateControl" style="margin-left: 10px" ></cc-date>
            </td>
          </tr>
          <tr>
            <th style="width: 90px;vertical-align: top;padding-top: 6px">Notes:</th>
            <td colspan="2">
              <textarea style="width: 100%; height: 100px;" [(ngModel)]="model.paymentNotes" tabindex="1"></textarea>
            </td>
        </table>
      </div>
      <div class="actions">
        <a cc-button right icon="ok" text="Save" (click)="model.completePayment()"></a>
        <a cc-button right icon="cancel" text="Cancel" (click)="model.cancelPayment()"></a>
      </div>
    </div>
    <div class="row" *ngIf="model.loading">
      <div class="details" style="padding-left: 0">
        <i style="font-size: 14px; margin-right:5px;position: relative;top:-2px;" class="icon-spin3 animate-spin"></i>Loading...
      </div>
    </div>
    <div class="row" *ngIf="!model.loading && !model.pastPayments.length">
      <div class="details" style="padding-left: 0">
        No past payments.
      </div>
    </div>
    <div class="row" *ngFor="let payment of model.pastPayments">
      <div class="details">
        <h4 style="display: inline-block">{{payment.date | dateString}}</h4>
        <div style="margin-left: -5px"><span [innerHTML]="payment.amount | money:true:true"></span></div>
        <div *ngIf="payment.hasNotes" style="margin-left: -5px;margin-top: 10px" class="muted">
          {{payment.notes | preserveLines}}
        </div>
      </div>
      <div class="actions">
      </div>
    </div>
  </div>
</div>